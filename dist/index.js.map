{"version":3,"file":"index.js","sources":["../src/queue.ts","../src/animator.ts","../src/utils.ts","../src/balloon.ts","../src/agent.ts","../src/agents/index.ts","../node_modules/rollup-plugin-styles/dist/runtime/inject-css.js","../src/index.ts","../src/load.ts"],"sourcesContent":["export default class Queue {\n    private _queue: Function[];\n    private _onEmptyCallback: any;\n    private _active: any;\n\n    constructor(onEmptyCallback: Function) {\n        this._queue = [];\n        this._onEmptyCallback = onEmptyCallback;\n    }\n\n    /***\n     *\n     * @param {function(Function)} func\n     * @returns {jQuery.Deferred}\n     */\n    public queue(func: Function) {\n        this._queue.push(func);\n\n        if (this._queue.length === 1 && !this._active) {\n            this._progressQueue();\n        }\n    }\n\n    private _progressQueue() {\n\n        // stop if nothing left in queue\n        if (!this._queue.length) {\n            this._onEmptyCallback();\n            return;\n        }\n\n        let f = this._queue.shift();\n        this._active = true;\n\n        // execute function\n        let completeFunction = this.next.bind(this);\n        if (f) f(completeFunction);\n    }\n\n    public clear() {\n        this._queue = [];\n    }\n\n    public next() {\n        this._active = false;\n        this._progressQueue();\n    }\n}\n\n\n\n","import { AgentConfig, AgentWrapper, ClippyAnimation, ClippyFrame } from './types';\n\n\nexport default class Animator {\n    public static States = { WAITING: 1, EXITED: 0 };\n\n    private _el: HTMLElement;\n    private _data: AgentConfig;\n    private _currentFrameIndex: number;\n    private _path: string;\n    private _exiting: boolean;\n    private _currentFrame?: ClippyFrame;\n    private _started: boolean;\n    private _sounds: Record<string, HTMLAudioElement>;\n    private _overlays: HTMLElement[];\n    private _endCallback?: Function;\n    private _currentAnimation?: ClippyAnimation;\n    private _loop?: number;\n\n    public currentAnimationName: string | undefined;\n\n    constructor (el: HTMLElement, config: AgentWrapper, sounds: Array<string>) {\n        this._el = el;\n        this._data = config.config;\n        this._path = config.image;\n        this._currentFrameIndex = 0;\n        this._currentFrame = undefined;\n        this._exiting = false;\n        this._currentAnimation = undefined;\n        this._endCallback = undefined;\n        this._started = false;\n        this._sounds = {};\n        this.currentAnimationName = undefined;\n        this.preloadSounds(sounds);\n        this._overlays = [this._el];\n        let curr = this._el;\n\n        this._setupElement(this._el);\n        for (let i = 1; i < this._data.overlayCount; i++) {\n            const divEl = document.createElement('div');\n            let inner = this._setupElement(divEl);\n            curr.append(inner);\n            this._overlays.push(inner);\n            curr = inner;\n        }\n    }\n\n    private _setupElement (el: HTMLElement) {\n        let frameSize = this._data.framesize;\n        el.style.display = \"none\";\n        el.style.width = frameSize[0] + \"px\";\n        el.style.height = frameSize[1] + \"px\";\n        el.style.background = \"url('\" + this._path + \"') no-repeat\";\n\n        return el;\n    }\n\n    animations () {\n        let r = [];\n        let d = this._data.animations;\n        for (let n in d) {\n            r.push(n);\n        }\n        return r;\n    }\n\n    preloadSounds(sounds: Array<string>): void {\n        for (let i = 0; i < this._data.sounds.length; i++) {\n            let snd: string = this._data.sounds[i];\n            let uri = sounds[i];\n            if (!uri) continue;\n            this._sounds[snd] = new Audio(uri);\n        }\n    }\n\n    hasAnimation (name: string) {\n        return !!this._data.animations[name];\n    }\n\n    exitAnimation () {\n        this._exiting = true;\n    }\n\n    showAnimation (animationName: string, stateChangeCallback: Function) {\n        this._exiting = false;\n\n        if (!this.hasAnimation(animationName)) {\n            return false;\n        }\n\n        this._currentAnimation = this._data.animations[animationName];\n        this.currentAnimationName = animationName;\n\n\n        if (!this._started) {\n            this._step();\n            this._started = true;\n        }\n\n        this._currentFrameIndex = 0;\n        this._currentFrame = undefined;\n        this._endCallback = stateChangeCallback;\n\n        return true;\n    }\n\n    private _draw () {\n        let images: Array<Array<number>> = [];\n        if (this._currentFrame) images = this._currentFrame.images || [];\n\n        for (let i = 0; i < this._overlays.length; i++) {\n            if (i < images.length) {\n                let xy = images[i];\n                let bg = -xy[0] + 'px ' + -xy[1] + 'px';\n                this._overlays[i].style.backgroundPosition = bg;\n                this._overlays[i].style.display = 'block';\n            }\n            else {\n                this._overlays[i].style.display = 'none';\n            }\n\n        }\n    }\n\n    private _getNextAnimationFrame (): number {\n        if (!this._currentAnimation) return 0;\n        // No current frame. start animation.\n        if (!this._currentFrame) return 0;\n        let currentFrame = this._currentFrame;\n        let branching = this._currentFrame.branching;\n\n\n        if (this._exiting && currentFrame.exitBranch !== undefined) {\n            return currentFrame.exitBranch;\n        }\n        else if (branching) {\n            let rnd = Math.random() * 100;\n            for (let i = 0; i < branching.branches.length; i++) {\n                let branch = branching.branches[i];\n                if (rnd <= branch.weight) {\n                    return branch.frameIndex;\n                }\n\n                rnd -= branch.weight;\n            }\n        }\n\n        return this._currentFrameIndex + 1;\n    }\n\n\n    private _playSound () {\n        let s = this._currentFrame?.sound;\n        if (!s) return;\n        let audio = this._sounds[s];\n        if (audio) audio.play();\n    }\n\n    private _atLastFrame () {\n        if (!this._currentAnimation) return false;\n        return this._currentFrameIndex >= this._currentAnimation.frames.length - 1;\n    }\n\n\n    private _step () {\n        if (!this._currentAnimation) return;\n        let newFrameIndex = Math.min(this._getNextAnimationFrame(), this._currentAnimation.frames.length - 1);\n        let frameChanged = !this._currentFrame || this._currentFrameIndex !== newFrameIndex;\n        this._currentFrameIndex = newFrameIndex;\n\n        // always switch frame data, unless we're at the last frame of an animation with a useExitBranching flag.\n        if (!(this._atLastFrame() && this._currentAnimation.useExitBranching)) {\n            this._currentFrame = this._currentAnimation.frames[this._currentFrameIndex];\n        }\n\n        this._draw();\n        this._playSound();\n\n        this._loop = window.setTimeout(this._step.bind(this), this._currentFrame!.duration);\n\n\n        // fire events if the frames changed and we reached an end\n        if (this._endCallback && frameChanged && this._atLastFrame()) {\n            if (this._currentAnimation.useExitBranching && !this._exiting) {\n                this._endCallback(this.currentAnimationName, Animator.States.WAITING);\n            }\n            else {\n                this._endCallback(this.currentAnimationName, Animator.States.EXITED);\n            }\n        }\n    }\n\n    /***\n     * Pause animation execution\n     */\n    pause () {\n        window.clearTimeout(this._loop);\n    }\n\n    /***\n     * Resume animation\n     */\n    resume () {\n        this._step();\n    }\n}\n\n\n","export const getWindowScroll = () => {\n    const supportPageOffset = window.pageXOffset !== undefined;\n    const isCSS1Compat = ((document.compatMode || \"\") === \"CSS1Compat\");\n\n    const scrollLeft = supportPageOffset ? window.pageXOffset : isCSS1Compat ? document.documentElement.scrollLeft : document.body.scrollLeft;\n    const scrollTop = supportPageOffset ? window.pageYOffset : isCSS1Compat ? document.documentElement.scrollTop : document.body.scrollTop;\n    return {\n        scrollLeft,\n        scrollTop\n    }\n}\n\nexport function getOffset(element: HTMLElement) {\n    if (!element.getClientRects().length) {\n        return { top: 0, left: 0 };\n    }\n\n    let rect = element.getBoundingClientRect();\n    let win = element.ownerDocument.defaultView || { pageXOffset: 0, pageYOffset: 0 };\n    return (\n        {\n            top: rect.top + win.pageYOffset,\n            left: rect.left + win.pageXOffset\n        });\n}\n\nexport function getWidth(el: HTMLElement, type: 'inner' | 'outer' | 'width' | 'full') {\n    if (type === 'inner') // .innerWidth()\n        return el.clientWidth;\n    else if (type === 'outer') // .outerWidth()\n        return el.offsetWidth;\n    let s = window.getComputedStyle(el, null);\n    if (type === 'width') // .width()\n        return el.clientWidth - parseInt(s.getPropertyValue('padding-left')) - parseInt(s.getPropertyValue('padding-right'));\n    else if (type === 'full') // .outerWidth(includeMargins = true)\n        return el.offsetWidth + parseInt(s.getPropertyValue('margin-left')) + parseInt(s.getPropertyValue('margin-right'));\n    return null;\n}\n\n\nexport function getHeight(el: HTMLElement, type: 'inner' | 'outer' | 'height' | 'full') {\n    if (type === 'inner') // .innerHeight()\n        return el.clientHeight;\n    else if (type === 'outer') // .outerHeight()\n        return el.offsetHeight;\n    let s = window.getComputedStyle(el, null);\n    if (type === 'height') // .height()\n        return el.clientHeight - parseInt(s.getPropertyValue('padding-top')) - parseInt(s.getPropertyValue('padding-bottom'));\n    else if (type === 'full') // .outerWidth(includeMargins = true)\n        return el.offsetHeight + parseInt(s.getPropertyValue('margin-top')) + parseInt(s.getPropertyValue('margin-bottom'));\n    return null;\n}\n\n\n// Stub for jQuery.Deferred\nexport class Deferred {\n    public promise!: Promise<void>;\n    public resolve!: (value?: any) => void;\n    public reject!: (reason?: any) => void;\n\n    constructor () {\n        this.promise = new Promise((resolve, reject) => {\n            this.resolve = resolve;\n            this.reject = reject;\n        });\n    }\n}\n","import { getHeight, getOffset, getWidth, getWindowScroll } from './utils';\nconst WORD_SPEAK_TIME: number = 200;\nconst CLOSE_BALLOON_DELAY = 2000;\nconst BALLOON_MARGIN = 15;\n\nexport default class Balloon {\n    private _targetEl: HTMLElement;\n    private _balloon?: HTMLElement;\n    private _content?: HTMLElement;\n    private _complete?: Function;\n\n    private _hiding: number | null = null;\n    private _loop: number | null = null;\n\n    private _hidden: boolean;\n    private _active: boolean = true;\n    private _hold: boolean = false;\n\n    private _addWord: (() => void) | null = null;\n    \n    constructor (targetEl: HTMLElement) {\n        this._targetEl = targetEl;\n        this._hidden = true;\n        this._setup();\n    }\n\n    private _setup () {\n        const balloonEl = document.createElement('div');\n        balloonEl.className = 'clippy-balloon';\n        balloonEl.setAttribute('hidden', 'true')\n        const tipEl = document.createElement('div');\n        tipEl.className = 'clippy-tip';\n        const contentEl = document.createElement('div');\n        contentEl.className = 'clippy-content';\n        balloonEl.appendChild(tipEl);\n        balloonEl.appendChild(contentEl);\n        this._balloon = balloonEl;\n        this._content = contentEl;\n\n        const targetEl = this._targetEl;\n        targetEl.insertAdjacentElement('afterend', balloonEl);\n    }\n\n    public reposition () {\n        let sides = ['top-left', 'top-right', 'bottom-left', 'bottom-right'];\n\n        for (let i = 0; i < sides.length; i++) {\n            let s = sides[i];\n            this._position(s);\n            if (!this._isOut()) break;\n        }\n    }\n\n    /***\n     *\n     * @param side\n     * @private\n     */\n    private _position (side: string) {\n        if (!this._balloon) return;\n\n        let o = getOffset(this._targetEl);\n        let h = getHeight(this._targetEl, 'height')!;\n        let w = getWidth(this._targetEl, 'width')!;\n\n\n        let {scrollLeft: sT, scrollTop: sL} = getWindowScroll();\n        o.top -= sT;\n        o.left -= sL;\n\n        let bH = getHeight(this._balloon, 'outer')!;\n        let bW = getWidth(this._balloon, 'outer')!; \n        \n        this._balloon.classList.remove('clippy-top-left');\n        this._balloon.classList.remove('clippy-top-right');\n        this._balloon.classList.remove('clippy-bottom-right');\n        this._balloon.classList.remove('clippy-bottom-left');\n\n        let left = 0, top = 0;\n        switch (side) {\n            case 'top-left':\n                // right side of the balloon next to the right side of the agent\n                left = o.left + w - bW;\n                top = o.top - bH - BALLOON_MARGIN;\n                break;\n            case 'top-right':\n                // left side of the balloon next to the left side of the agent\n                left = o.left;\n                top = o.top - bH - BALLOON_MARGIN;\n                break;\n            case 'bottom-right':\n                // right side of the balloon next to the right side of the agent\n                left = o.left;\n                top = o.top + h + BALLOON_MARGIN;\n                break;\n            case 'bottom-left':\n                // left side of the balloon next to the left side of the agent\n                left = o.left + w - bW;\n                top = o.top + h + BALLOON_MARGIN;\n                break;\n        }\n\n        this._balloon.style.top = top + 'px';\n        this._balloon.style.left = left + 'px';\n        this._balloon.classList.add('clippy-' + side);\n    }\n\n    private _isOut () {\n        if (!this._balloon) return;\n        \n        let o = getOffset(this._balloon);\n        let bH = getHeight(this._balloon, 'outer')!;\n        let bW = getWidth(this._balloon, 'outer')!; \n\n        let wW = document.querySelector('html')!.clientWidth; \n        let wH = document.querySelector('html')!.clientHeight;\n        let {scrollLeft: sT, scrollTop: sL} = getWindowScroll();\n\n        let top = o.top - sT;\n        let left = o.left - sL;\n        let m = 5;\n        if (top - m < 0 || left - m < 0) return true;\n        return (top + bH + m) > wH || (left + bW + m) > wW;\n    }\n\n    public speak (complete: Function, text: string, hold: boolean) {\n        this._hidden = false;\n        this.show();\n        let c = this._content;\n\n        if (!c) return;\n        \n        // set height to auto\n        c.style.height = 'auto';\n        c.style.width = 'auto';\n\n        // add the text\n        c.innerHTML = text;\n        \n        // set height\n        c.style.height = c.style.height || '';\n        c.style.width = c.style.width || '';\n        c.innerHTML = '';\n        this.reposition();\n\n        this._complete = complete;\n        this._sayWords(text, hold, complete);\n    }\n\n    public show () {\n        if (!this._balloon) return;\n        if (this._hidden) return;\n        this._balloon.removeAttribute('hidden');\n    }\n\n    public hide (fast?: boolean) {\n        if (fast) {\n            this._balloon?.setAttribute('hidden', 'true');\n            return;\n        }\n\n        this._hiding = window.setTimeout(this._finishHideBalloon.bind(this), CLOSE_BALLOON_DELAY);\n    }\n\n    private _finishHideBalloon () {\n        if (this._active) return;\n        this._balloon?.setAttribute('hidden', 'true');\n        this._hidden = true;\n        this._hiding = null;\n    }\n\n    private _sayWords (text: string, hold: boolean, complete: Function) {\n        this._active = true;\n        this._hold = hold;\n        let words = text.split(/[^\\S-]/);\n        let time = WORD_SPEAK_TIME;\n        let el = this._content;\n        let idx = 1;\n\n\n        this._addWord = () => {\n            if (!this._active) return;\n            if (idx > words.length) {\n                this._addWord = null;\n                this._active = false;\n                if (!this._hold) {\n                    complete();\n                    this.hide(false);\n                }\n            } else {\n                if (el) el.innerHTML = words.slice(0, idx).join(' ');\n                idx++;\n                // @ts-ignore\n                this._loop = window.setTimeout(this._addWord?.bind(this), time);\n            }\n        };\n\n        this._addWord();\n\n    }\n\n    public close () {\n        if (this._active) {\n            this._hold = false;\n        } else if (this._hold && this._complete) {\n            this._complete();\n        }\n    }\n\n    public pause () {\n        if (this._loop) {\n            window.clearTimeout(this._loop);\n        }\n        if (this._hiding) {\n            window.clearTimeout(this._hiding);\n            this._hiding = null;\n        }\n    }\n\n    public resume () {\n        if (this._addWord) {\n            this._addWord();\n        } else if (!this._hold && !this._hidden) {\n            this._hiding = window.setTimeout(this._finishHideBalloon.bind(this), CLOSE_BALLOON_DELAY);\n        }\n    }\n}\n\n\n","import Queue from './queue'\nimport Animator from './animator'\nimport Balloon from './balloon'\nimport { AgentWrapper } from './types';\nimport { Deferred, getHeight, getOffset, getWidth, getWindowScroll } from './utils';\n\nexport interface AgentOptions {\n    agent: AgentWrapper;\n    selector?: string;\n}\n\nexport default class Agent {\n    private _queue: Queue;\n    private readonly _el: HTMLElement;\n    private _animator: Animator;\n    private _balloon: Balloon;\n    private _hidden: boolean = false;\n    private _idleDfd?: Deferred;\n    private _offset: { top: number; left: number; } = { top: 0, left: 0 };\n    private _dragUpdateLoop?: number;\n    private _targetX?: number;\n    private _targetY?: number;\n    private _moveHandle?: ((e: MouseEvent) => void); \n    private _upHandle?: ((e: MouseEvent) => void); \n\n    constructor (options: AgentOptions) {\n        const {\n            agent,\n            selector\n        } = options;\n\n        this._queue = new Queue(this._onQueueEmpty.bind(this));\n\n        const el = document.createElement('div');\n        el.className = 'clippy';\n        el.setAttribute('hidden', 'true');\n        this._el = el;\n\n        let selectorEl = selector ? document.getElementsByClassName(selector)[0] : undefined;\n        (selectorEl || document.body).appendChild(this._el);\n        \n        const agentSounds: string[] = Object.values(options.agent.soundMp3 as unknown as Array<string>);\n\n        this._animator = new Animator(this._el, agent, agentSounds);\n        this._balloon = new Balloon(this._el);\n        this._setupEvents();\n    }\n\n    /***\n     *\n     * @param {Number} x\n     * @param {Number} y\n     */\n    gestureAt (x: number, y: number) {\n        let d = this._getDirection(x, y);\n        let gAnim = 'Gesture' + d;\n        let lookAnim = 'Look' + d;\n\n        let animation = this.hasAnimation(gAnim) ? gAnim : lookAnim;\n        return this.play(animation);\n    }\n\n    /***\n     *\n     * @param {Boolean=} fast\n     *\n     */\n    hide (fast: boolean, callback: () => void) {\n        this._hidden = true;\n        let el = this._el;\n        this.stop();\n        if (fast) {\n            this._el.setAttribute('hidden', 'true');\n            this.stop();\n            this.pause();\n            if (callback) callback();\n            return;\n        }\n\n        return this._playInternal('Hide',  () => {\n            this._el.setAttribute('hidden', 'true');\n            this.pause();\n            if (callback) callback();\n        })\n    }\n\n\n    moveTo (x: number, y: number, duration: number) {\n        let dir = this._getDirection(x, y);\n        let anim = 'Move' + dir;\n        if (duration === undefined) duration = 1000;\n\n        this._addToQueue( (complete: Function) => {\n            // the simple case\n            if (duration === 0) {\n                this._el.style.top = y + 'px';\n                this._el.style.left = x + 'px';\n                this.reposition();\n                complete();\n                return;\n            }\n\n            // no animations\n            if (!this.hasAnimation(anim)) {\n                const endHandler = () => {\n                    this._el.removeEventListener('animationend', endHandler);\n                    complete();\n                }\n                this._el.addEventListener('animationend', endHandler);\n                this._el.animate({ top: y, left: x }, {\n                    duration,\n                    iterations: 1,\n                });\n                return;\n            }\n\n            let callback =  (name: string, state: number) => {\n                // when exited, complete\n                if (state === Animator.States.EXITED) {\n                    complete();\n                }\n                // if waiting,\n                if (state === Animator.States.WAITING) {\n\n                    const endHandler = () => {\n                        this._el.removeEventListener('animationend', endHandler);\n                        this._animator.exitAnimation();;\n                    }\n                    this._el.addEventListener('animationend', endHandler);\n                    this._el.animate({ top: y + \"px\", left: x + \"px\"}, {\n                        duration,\n                        iterations: 1,\n                    });\n                }\n\n            };\n\n            this._playInternal(anim, callback);\n        }, this);\n    }\n\n    private _playInternal (animation: any, callback: Function) {\n\n        // if we're inside an idle animation,\n        if (this._isIdleAnimation() && this._idleDfd) {\n            this._idleDfd.promise.then(() => {\n                this._playInternal(animation, callback);\n            })\n        }\n\n        this._animator.showAnimation(animation, callback);\n    }\n\n    play (animation: any, timeout?: number, cb?: Function) {\n        if (!this.hasAnimation(animation)) return false;\n\n        if (timeout === undefined) timeout = 5000;\n\n\n        this._addToQueue( (complete: Function) => {\n            let completed = false;\n            // handle callback\n            let callback = function (name: string, state: number) {\n                if (state === Animator.States.EXITED) {\n                    completed = true;\n                    if (cb) cb();\n                    complete();\n                }\n            };\n\n            // if has timeout, register a timeout function\n            if (timeout) {\n                window.setTimeout(() => {\n                    if (completed) return;\n                    // exit after timeout\n                    this._animator.exitAnimation();\n                }, timeout)\n            }\n\n            this._playInternal(animation, callback);\n        }, this);\n\n        return true;\n    }\n\n    /***\n     *\n     * @param {Boolean=} fast\n     */\n    show (fast: boolean = true) {\n\n        this._hidden = false;\n        if (fast) {\n            this._el.removeAttribute('hidden');\n            this.resume();\n            this._onQueueEmpty();\n            return;\n        }\n\n        const cssTop = this._el.style.top;\n        const cssLeft = this._el.style.left;\n        if (cssTop === 'auto' || !(cssLeft === 'auto')){\n            let wW = document.querySelector('html')!.clientWidth; \n            let wH = document.querySelector('html')!.clientHeight;\n            let {scrollLeft: sT} = getWindowScroll();\n            let left = wW * 0.8;\n            let top = (wH + sT) * 0.8;\n            this._el.style.top = top + 'px';\n            this._el.style.left = left + 'px';\n        }\n\n        this.resume();\n        return this.play('Show');\n    }\n\n    /***\n     *\n     * @param {String} text\n     */\n    speak (text: string, hold: boolean = false) {\n        this._addToQueue( (complete: Function) => {\n            this._balloon.speak(complete, text, hold);\n        }, this);\n    }\n\n\n    /***\n     * Close the current balloon\n     */\n    closeBalloon () {\n        this._balloon.hide();\n    }\n\n    delay (time: number) {\n        time = time || 250;\n\n        this._addToQueue( (complete: Function) => {\n            this._onQueueEmpty();\n            window.setTimeout(complete, time);\n        });\n    }\n\n    /***\n     * Skips the current animation\n     */\n    stopCurrent () {\n        this._animator.exitAnimation();\n        this._balloon.close();\n    }\n\n\n    stop () {\n        // clear the queue\n        this._queue.clear();\n        this._animator.exitAnimation();\n        this._balloon.hide();\n    }\n\n    /***\n     *\n     * @param {String} name\n     * @returns {Boolean}\n     */\n    hasAnimation (name: string) {\n        return this._animator.hasAnimation(name);\n    }\n\n    /***\n     * Gets a list of animation names\n     *\n     * @return {Array.<string>}\n     */\n    animations () {\n        return this._animator.animations();\n    }\n\n    /***\n     * Play a random animation\n     * @return {Deferred}\n     */\n    animate (): any {\n        let animations = this.animations();\n        let anim = animations[Math.floor(Math.random() * animations.length)];\n        // skip idle animations\n        if (anim.indexOf('Idle') === 0) {\n            return this.animate();\n        }\n        return this.play(anim);\n    }\n\n    /**************************** Utils ************************************/\n\n    /***\n     *\n     * @param {Number} x\n     * @param {Number} y\n     * @return {String}\n     * @private\n     */\n    private _getDirection (x: number, y: number) {\n        let offset = getOffset(this._el);\n        let h = getHeight(this._el, 'height')!;\n        let w = getWidth(this._el, 'width')!;\n\n        let centerX = (offset.left + w / 2);\n        let centerY = (offset.top + h / 2);\n\n\n        let a = centerY - y;\n        let b = centerX - x;\n\n        let r = Math.round((180 * Math.atan2(a, b)) / Math.PI);\n\n        // Left and Right are for the character, not the screen :-/\n        if (-45 <= r && r < 45) return 'Right';\n        if (45 <= r && r < 135) return 'Up';\n        if (135 <= r && r <= 180 || -180 <= r && r < -135) return 'Left';\n        if (-135 <= r && r < -45) return 'Down';\n\n        // sanity check\n        return 'Top';\n    }\n\n    /**************************** Queue and Idle handling ************************************/\n\n    /***\n     * Handle empty queue.\n     * We need to transition the animation to an idle state\n     * @private\n     */\n    private _onQueueEmpty () {\n        if (this._hidden || this._isIdleAnimation()) return;\n        let idleAnim = this._getIdleAnimation();\n        this._idleDfd = new Deferred();\n\n        this._animator.showAnimation(idleAnim, this._onIdleComplete.bind(this));\n    }\n\n    private _onIdleComplete (name: string, state: number) {\n        if (state === Animator.States.EXITED) {\n            this._idleDfd?.resolve(undefined);\n        }\n    }\n\n    /***\n     * Is the current animation is Idle?\n     * @return {Boolean}\n     * @private\n     */\n    private _isIdleAnimation () {\n        let c = this._animator.currentAnimationName;\n        return c && c.indexOf('Idle') === 0;\n    }\n\n\n    /**\n     * Gets a random Idle animation\n     * @return {String}\n     * @private\n     */\n    private _getIdleAnimation () {\n        let animations = this.animations();\n        let r = [];\n        for (let i = 0; i < animations.length; i++) {\n            let a = animations[i];\n            if (a.indexOf('Idle') === 0) {\n                r.push(a);\n            }\n        }\n\n        // pick one\n        let idx = Math.floor(Math.random() * r.length);\n        return r[idx];\n    }\n\n    /**************************** Events ************************************/\n\n    private _setupEvents () {\n        window.addEventListener('resize', this.reposition.bind(this));\n        this._el.addEventListener('mousedown', this._onMouseDown.bind(this));\n        this._el.addEventListener('dblclick', this._onDoubleClick.bind(this));\n    }\n\n    private _onDoubleClick () {\n        if (!this.play('ClickedOn')) {\n            this.animate();\n        }\n    }\n\n    reposition () {\n        if (!(this._el.getAttribute('hidden') === 'true')) return;\n        let o = getOffset(this._el);\n        let bH = getHeight(this._el, 'outer')!;\n        let bW = getWidth(this._el, 'outer')!; \n\n        let wW = document.querySelector('html')!.clientWidth; \n        let wH = document.querySelector('html')!.clientHeight;\n        let {scrollLeft: sT, scrollTop: sL} = getWindowScroll();\n\n        let top = o.top - sT;\n        let left = o.left - sL;\n        let m = 5;\n        if (top - m < 0) {\n            top = m;\n        } else if ((top + bH + m) > wH) {\n            top = wH - bH - m;\n        }\n\n        if (left - m < 0) {\n            left = m;\n        } else if (left + bW + m > wW) {\n            left = wW - bW - m;\n        }\n\n        this._el.style.left = left + 'px';\n        this._el.style.top = top + 'px';\n        // reposition balloon\n        this._balloon.reposition();\n    }\n\n    private _onMouseDown (e: MouseEvent) {\n        e.preventDefault();\n        this._startDrag(e);\n    }\n\n\n    /**************************** Drag ************************************/\n\n    private _startDrag (e: MouseEvent) {\n        // pause animations\n        this.pause();\n        this._balloon.hide(true);\n        this._offset = this._calculateClickOffset(e);\n\n        this._moveHandle = this._dragMove.bind(this);\n        this._upHandle = this._finishDrag.bind(this);\n\n        window.addEventListener(\"mousemove\", this._moveHandle);\n        window.addEventListener(\"mouseup\", this._upHandle);\n\n        this._dragUpdateLoop = window.setTimeout(this._updateLocation.bind(this), 10);\n    }\n\n    private _calculateClickOffset (e: MouseEvent) {\n        let mouseX = e.pageX;\n        let mouseY = e.pageY;\n        let o = getOffset(this._el);\n        return {\n            top: mouseY - o.top,\n            left: mouseX - o.left\n        }\n\n    }\n\n    private _updateLocation () {\n        this._el.style.top = (this._targetY || 0) + 'px';\n        this._el.style.left = (this._targetX || 0) + 'px';\n        this._dragUpdateLoop = window.setTimeout(this._updateLocation.bind(this), 10);\n    }\n\n    private _dragMove (e: MouseEvent) {\n        e.preventDefault();\n        let x = e.clientX - this._offset.left;\n        let y = e.clientY - this._offset.top;\n        this._targetX = x;\n        this._targetY = y;\n    }\n\n    private _finishDrag () {\n        window.clearTimeout(this._dragUpdateLoop);\n        // remove handles\n        if (this._moveHandle) {\n            window.removeEventListener(\"mousemove\", this._moveHandle);\n        }\n        if (this._upHandle) {\n            window.removeEventListener(\"mouseup\", this._upHandle);\n        }\n        // resume animations\n        this._balloon.show();\n        this.reposition();\n        this.resume();\n\n    }\n\n    private _addToQueue (func: Function, scope?: any) {\n        if (scope) func = func.bind(scope);\n        this._queue.queue(func);\n    }\n\n    /**************************** Pause and Resume ************************************/\n\n    pause () {\n        this._animator.pause();\n        this._balloon.pause();\n\n    }\n\n    resume () {\n        this._animator.resume();\n        this._balloon.resume();\n    }\n\n}","import { AgentType } from '../types';\n\nfunction loadAgent (name: AgentType) {\n    return new Promise<any>((resolve, reject) => {\n        import(`./agents/${name}.js`).then(module => {\n            resolve(module.default);\n        }).catch(err => {\n            reject(err);\n        });\n    });\n}\n\nexport const agents: Record<string, any> = {\n    Bonzi: () => loadAgent('Bonzi'),\n    Clippy: () => loadAgent('Clippy'),\n    F1: () => loadAgent('F1'),\n    Genie: () => loadAgent('Genie'),\n    Genius: () => loadAgent('Genius'),\n    Links: () => loadAgent('Links'),\n    Merlin: () => loadAgent('Merlin'),\n    Peedy: () => loadAgent('Peedy'),\n    Rocky: () => loadAgent('Rocky'),\n    Rover: () => loadAgent('Rover'),\n    Otto: () => loadAgent('Otto'),\n};\n","var e=[],t=[];function n(n,r){if(n&&\"undefined\"!=typeof document){var a,s=!0===r.prepend?\"prepend\":\"append\",d=!0===r.singleTag,i=\"string\"==typeof r.container?document.querySelector(r.container):document.getElementsByTagName(\"head\")[0];if(d){var u=e.indexOf(i);-1===u&&(u=e.push(i)-1,t[u]={}),a=t[u]&&t[u][s]?t[u][s]:t[u][s]=c()}else a=c();65279===n.charCodeAt(0)&&(n=n.substring(1)),a.styleSheet?a.styleSheet.cssText+=n:a.appendChild(document.createTextNode(n))}function c(){var e=document.createElement(\"style\");if(e.setAttribute(\"type\",\"text/css\"),r.attributes)for(var t=Object.keys(r.attributes),n=0;n<t.length;n++)e.setAttribute(t[n],r.attributes[t[n]]);var a=\"prepend\"===s?\"afterbegin\":\"beforeend\";return i.insertAdjacentElement(a,e),e}}export{n as default};\n","import type Agent from './agent'\nimport type Animator from './animator'\nimport type Queue from './queue'\nimport type Balloon from './balloon'\nimport { load } from './load'\nimport { AgentType, AgentWrapper, Clippy } from './types'\nimport \"./clippy.css\";\n\nconst clippy: Clippy = {\n    load,\n    agents: {} as Record<AgentType, AgentWrapper>,\n}\n\nexport type { Agent, Animator, Queue, Balloon };\nexport default clippy;\n","import Agent from './agent'\nimport { agents } from './agents';\nimport { AgentWrapper, LoadOptions } from './types';\n\nexport const load = (options: LoadOptions) => {\n    const {\n        name,\n        successCb,\n        failCb,\n        selector,\n    } = options || {};\n\n    // wrapper to the success callback\n    agents[name]().then((agentConfig: AgentWrapper) => {\n        const a = new Agent({\n            agent: agentConfig,\n            selector\n        });\n        if (successCb) successCb(a);\n    }).catch((error: any) => {\n        if (failCb) failCb(error);\n    });\n\n}"],"names":["Queue","onEmptyCallback","this","_queue","_onEmptyCallback","queue","func","push","length","_active","_progressQueue","prototype","let","f","shift","completeFunction","next","bind","clear","Animator","el","config","sounds","_el","_data","_path","image","_currentFrameIndex","_currentFrame","undefined","_exiting","_currentAnimation","_endCallback","_started","_sounds","currentAnimationName","preloadSounds","_overlays","curr","_setupElement","i","overlayCount","const","divEl","document","createElement","inner","append","frameSize","framesize","style","display","width","height","background","animations","r","d","n","snd","uri","Audio","hasAnimation","name","exitAnimation","showAnimation","animationName","stateChangeCallback","_step","_draw","images","xy","bg","backgroundPosition","_getNextAnimationFrame","currentFrame","branching","exitBranch","rnd","Math","random","branches","branch","weight","frameIndex","_playSound","s","_a","sound","audio","play","_atLastFrame","frames","newFrameIndex","min","frameChanged","useExitBranching","_loop","window","setTimeout","duration","States","WAITING","EXITED","pause","clearTimeout","resume","getWindowScroll","supportPageOffset","pageXOffset","isCSS1Compat","compatMode","documentElement","scrollLeft","body","pageYOffset","scrollTop","getOffset","element","getClientRects","top","left","rect","getBoundingClientRect","win","ownerDocument","defaultView","getWidth","type","clientWidth","offsetWidth","getComputedStyle","parseInt","getPropertyValue","getHeight","clientHeight","offsetHeight","Deferred","promise","Promise","resolve","reject","Balloon","targetEl","_hiding","_hold","_addWord","_targetEl","_hidden","_setup","balloonEl","className","setAttribute","tipEl","contentEl","appendChild","_balloon","_content","insertAdjacentElement","reposition","sides","_position","_isOut","side","o","h","w","ref","sT","sL","bH","bW","classList","remove","add","wW","querySelector","wH","speak","complete","text","hold","show","c","innerHTML","_complete","_sayWords","removeAttribute","hide","fast","_finishHideBalloon","words","split","idx","slice","join","close","Agent","options","_offset","agent","selector","_onQueueEmpty","getElementsByClassName","agentSounds","Object","values","soundMp3","_animator","_setupEvents","loadAgent","import","then","module","default","catch","err","gestureAt","x","y","_getDirection","gAnim","lookAnim","animation","callback","stop","_playInternal","moveTo","anim","_addToQueue","endHandler","removeEventListener","addEventListener","animate","iterations","state","_isIdleAnimation","_idleDfd","timeout","cb","completed","cssTop","cssLeft","closeBalloon","delay","time","stopCurrent","floor","indexOf","offset","centerX","a","b","round","atan2","PI","idleAnim","_getIdleAnimation","_onIdleComplete","_onMouseDown","_onDoubleClick","getAttribute","e","preventDefault","_startDrag","_calculateClickOffset","_moveHandle","_dragMove","_upHandle","_finishDrag","_dragUpdateLoop","_updateLocation","mouseX","pageX","mouseY","pageY","_targetY","_targetX","clientX","clientY","scope","agents","Bonzi","Clippy","F1","Genie","Genius","Links","Merlin","Peedy","Rocky","Rover","Otto","t","prepend","singleTag","container","getElementsByTagName","u","charCodeAt","substring","styleSheet","cssText","createTextNode","attributes","keys","clippy","successCb","failCb","agentConfig","error"],"mappings":"AAAc,IAAOA,EAKjB,SAAYC,GACRC,KAAKC,OAAS,GACdD,KAAKE,iBAAmBH,CAC5B,cAOOI,MAAK,SAACC,GACTJ,KAAKC,OAAOI,KAAKD,GAEU,IAAvBJ,KAAKC,OAAOK,QAAiBN,KAAKO,SAClCP,KAAKQ,gBAEb,EAEQV,EAAAW,UAAAD,eAAA,WAGJ,GAAKR,KAAKC,OAAOK,OAAjB,CAKAI,IAAIC,EAAIX,KAAKC,OAAOW,QACpBZ,KAAKO,SAAU,EAGfG,IAAIG,EAAmBb,KAAKc,KAAKC,KAAKf,MAClCW,GAAGA,EAAEE,EAPR,MAFGb,KAAKE,kBAUb,EAEOJ,EAAAW,UAAAO,MAAA,WACHhB,KAAKC,OAAS,EAClB,EAEOH,EAAAW,UAAAK,KAAA,WACHd,KAAKO,SAAU,EACfP,KAAKQ,gBACT,EC3CJ,IAAqBS,EAkBjB,SAAaC,EAAiBC,EAAsBC,GAChDpB,KAAKqB,IAAMH,EACXlB,KAAKsB,MAAQH,EAAOA,OACpBnB,KAAKuB,MAAQJ,EAAOK,MACpBxB,KAAKyB,mBAAqB,EAC1BzB,KAAK0B,mBAAgBC,EACrB3B,KAAK4B,UAAW,EAChB5B,KAAK6B,uBAAoBF,EACzB3B,KAAK8B,kBAAeH,EACpB3B,KAAK+B,UAAW,EAChB/B,KAAKgC,QAAU,GACfhC,KAAKiC,0BAAuBN,EAC5B3B,KAAKkC,cAAcd,GACnBpB,KAAKmC,UAAY,CAACnC,KAAKqB,KACvBX,IAAI0B,EAAOpC,KAAKqB,IAEhBrB,KAAKqC,cAAcrC,KAAKqB,KACxB,IAAKX,IAAI4B,EAAI,EAAGA,EAAItC,KAAKsB,MAAMiB,aAAcD,IAAK,CAC9CE,IAAMC,EAAQC,SAASC,cAAc,OACjCC,EAAQ5C,KAAKqC,cAAcI,GAC/BL,EAAKS,OAAOD,GACZ5C,KAAKmC,UAAU9B,KAAKuC,GACpBR,EAAOQ,CACV,CACL,cAEQP,cAAa,SAAEnB,GACnBR,IAAIoC,EAAY9C,KAAKsB,MAAMyB,UAM3B,OALA7B,EAAG8B,MAAMC,QAAU,OACnB/B,EAAG8B,MAAME,MAAQJ,EAAU,GAAK,KAChC5B,EAAG8B,MAAMG,OAASL,EAAU,GAAK,KACjC5B,EAAG8B,MAAMI,WAAa,QAAUpD,KAAKuB,MAAQ,eAEtCL,CACX,EAEAD,EAAAR,UAAA4C,WAAA,WACI3C,IAAI4C,EAAI,GACJC,EAAIvD,KAAKsB,MAAM+B,WACnB,IAAK3C,IAAI8C,KAAKD,EACVD,EAAEjD,KAAKmD,GAEX,OAAOF,CACX,cAEApB,cAAa,SAACd,GACV,IAAKV,IAAI4B,EAAI,EAAGA,EAAItC,KAAKsB,MAAMF,OAAOd,OAAQgC,IAAK,CAC/C5B,IAAI+C,EAAczD,KAAKsB,MAAMF,OAAOkB,GAChCoB,EAAMtC,EAAOkB,GACZoB,IACL1D,KAAKgC,QAAQyB,GAAO,IAAIE,MAAMD,GACjC,CACL,cAEAE,aAAY,SAAEC,GACV,QAAS7D,KAAKsB,MAAM+B,WAAWQ,EACnC,EAEA5C,EAAAR,UAAAqD,cAAA,WACI9D,KAAK4B,UAAW,CACpB,EAEAX,EAAAR,UAAAsD,cAAA,SAAeC,EAAuBC,GAGlC,OAFAjE,KAAK4B,UAAW,IAEX5B,KAAK4D,aAAaI,KAIvBhE,KAAK6B,kBAAoB7B,KAAKsB,MAAM+B,WAAWW,GAC/ChE,KAAKiC,qBAAuB+B,EAGvBhE,KAAK+B,WACN/B,KAAKkE,QACLlE,KAAK+B,UAAW,GAGpB/B,KAAKyB,mBAAqB,EAC1BzB,KAAK0B,mBAAgBC,EACrB3B,KAAK8B,aAAemC,GAEb,EACX,EAEQhD,EAAAR,UAAA0D,MAAA,WACJzD,IAAI0D,EAA+B,GAC/BpE,KAAK0B,gBAAe0C,EAASpE,KAAK0B,cAAc0C,QAAU,IAE9D,IAAK1D,IAAI4B,EAAI,EAAGA,EAAItC,KAAKmC,UAAU7B,OAAQgC,IACvC,GAAIA,EAAI8B,EAAO9D,OAAQ,CACnBI,IAAI2D,EAAKD,EAAO9B,GACZgC,GAAMD,EAAG,GAAK,OAASA,EAAG,GAAK,KACnCrE,KAAKmC,UAAUG,GAAGU,MAAMuB,mBAAqBD,EAC7CtE,KAAKmC,UAAUG,GAAGU,MAAMC,QAAU,OACrC,MAEGjD,KAAKmC,UAAUG,GAAGU,MAAMC,QAAU,MAI9C,EAEQhC,EAAAR,UAAA+D,uBAAA,WACJ,IAAKxE,KAAK6B,kBAAmB,OAAO,EAEpC,IAAK7B,KAAK0B,cAAe,OAAO,EAChChB,IAAI+D,EAAezE,KAAK0B,cACpBgD,EAAY1E,KAAK0B,cAAcgD,UAGnC,GAAI1E,KAAK4B,eAAwCD,IAA5B8C,EAAaE,WAC9B,OAAOF,EAAaE,WAEnB,GAAID,EAEL,IADAhE,IAAIkE,EAAsB,IAAhBC,KAAKC,SACNxC,EAAI,EAAGA,EAAIoC,EAAUK,SAASzE,OAAQgC,IAAK,CAChD5B,IAAIsE,EAASN,EAAUK,SAASzC,GAChC,GAAIsC,GAAOI,EAAOC,OACd,OAAOD,EAAOE,WAGlBN,GAAOI,EAAOC,MACjB,CAGL,OAAOjF,KAAKyB,mBAAqB,CACrC,EAGQR,EAAAR,UAAA0E,WAAA,iBACAC,EAAsB,QAAlBC,EAAArF,KAAK0B,qBAAa,IAAA2D,OAAA,EAAAA,EAAEC,MAC5B,GAAKF,EAAL,CACA1E,IAAI6E,EAAQvF,KAAKgC,QAAQoD,GACrBG,GAAOA,EAAMC,MAFF,CAGnB,EAEQvE,EAAAR,UAAAgF,aAAA,WACJ,QAAKzF,KAAK6B,mBACH7B,KAAKyB,oBAAsBzB,KAAK6B,kBAAkB6D,OAAOpF,OAAS,CAC7E,EAGQW,EAAAR,UAAAyD,MAAA,WACJ,GAAKlE,KAAK6B,kBAAV,CACAnB,IAAIiF,EAAgBd,KAAKe,IAAI5F,KAAKwE,yBAA0BxE,KAAK6B,kBAAkB6D,OAAOpF,OAAS,GAC/FuF,GAAgB7F,KAAK0B,eAAiB1B,KAAKyB,qBAAuBkE,EACtE3F,KAAKyB,mBAAqBkE,EAGpB3F,KAAKyF,gBAAkBzF,KAAK6B,kBAAkBiE,mBAChD9F,KAAK0B,cAAgB1B,KAAK6B,kBAAkB6D,OAAO1F,KAAKyB,qBAG5DzB,KAAKmE,QACLnE,KAAKmF,aAELnF,KAAK+F,MAAQC,OAAOC,WAAWjG,KAAKkE,MAAMnD,KAAKf,MAAOA,KAAK0B,cAAewE,UAItElG,KAAK8B,cAAgB+D,GAAgB7F,KAAKyF,iBACtCzF,KAAK6B,kBAAkBiE,mBAAqB9F,KAAK4B,SACjD5B,KAAK8B,aAAa9B,KAAKiC,qBAAsBhB,EAASkF,OAAOC,SAG7DpG,KAAK8B,aAAa9B,KAAKiC,qBAAsBhB,EAASkF,OAAOE,QAtBjC,CAyBxC,EAKApF,EAAAR,UAAA6F,MAAA,WACIN,OAAOO,aAAavG,KAAK+F,MAC7B,EAKA9E,EAAAR,UAAA+F,OAAA,WACIxG,KAAKkE,OACT,EAxMcjD,EAAMkF,OAAG,CAAEC,QAAS,EAAGC,OAAQ,GCJ1C7D,IAAMiE,EAAe,WACxBjE,IAAMkE,OAA2C/E,IAAvBqE,OAAOW,YAC3BC,EAAgD,gBAA/BlE,SAASmE,YAAc,IAI9C,MAAO,YAFYH,EAAoBV,OAAOW,YAAcC,EAAelE,SAASoE,gBAAgBC,WAAarE,SAASsE,KAAKD,qBAC7GL,EAAoBV,OAAOiB,YAAcL,EAAelE,SAASoE,gBAAgBI,UAAYxE,SAASsE,KAAKE,UAKjI,EAEM,SAAUC,EAAUC,GACtB,IAAKA,EAAQC,iBAAiB/G,OAC1B,MAAO,CAAEgH,IAAK,EAAGC,KAAM,GAG3B7G,IAAI8G,EAAOJ,EAAQK,wBACfC,EAAMN,EAAQO,cAAcC,aAAe,CAAEjB,YAAa,EAAGM,YAAa,GAC9E,MACI,CACIK,IAAKE,EAAKF,IAAMI,EAAIT,YACpBM,KAAMC,EAAKD,KAAOG,EAAIf,YAElC,CAEgB,SAAAkB,EAAS3G,EAAiB4G,GACtC,GAAa,UAATA,EACA,OAAO5G,EAAG6G,YACT,GAAa,UAATD,EACL,OAAO5G,EAAG8G,YACdtH,IAAI0E,EAAIY,OAAOiC,iBAAiB/G,EAAI,MACpC,MAAa,UAAT4G,EACO5G,EAAG6G,YAAcG,SAAS9C,EAAE+C,iBAAiB,iBAAmBD,SAAS9C,EAAE+C,iBAAiB,kBACrF,SAATL,EACE5G,EAAG8G,YAAcE,SAAS9C,EAAE+C,iBAAiB,gBAAkBD,SAAS9C,EAAE+C,iBAAiB,iBAC/F,IACX,CAGgB,SAAAC,EAAUlH,EAAiB4G,GACvC,GAAa,UAATA,EACA,OAAO5G,EAAGmH,aACT,GAAa,UAATP,EACL,OAAO5G,EAAGoH,aACd5H,IAAI0E,EAAIY,OAAOiC,iBAAiB/G,EAAI,MACpC,MAAa,WAAT4G,EACO5G,EAAGmH,aAAeH,SAAS9C,EAAE+C,iBAAiB,gBAAkBD,SAAS9C,EAAE+C,iBAAiB,mBACrF,SAATL,EACE5G,EAAGoH,aAAeJ,SAAS9C,EAAE+C,iBAAiB,eAAiBD,SAAS9C,EAAE+C,iBAAiB,kBAC/F,IACX,KAIaI,EAKT,sBACIvI,KAAKwI,QAAU,IAAIC,SAAO,SAAEC,EAASC,GACjC3I,EAAK0I,QAAUA,EACf1I,EAAK2I,OAASA,CAClB,GACJ,EC5DiBC,EAejB,SAAaC,GATL7I,KAAO8I,QAAkB,KACzB9I,KAAK+F,MAAkB,KAGvB/F,KAAOO,SAAY,EACnBP,KAAK+I,OAAY,EAEjB/I,KAAQgJ,SAAwB,KAGpChJ,KAAKiJ,UAAYJ,EACjB7I,KAAKkJ,SAAU,EACflJ,KAAKmJ,QACT,EAEQP,EAAAnI,UAAA0I,OAAA,WACJ3G,IAAM4G,EAAY1G,SAASC,cAAc,OACzCyG,EAAUC,UAAY,iBACtBD,EAAUE,aAAa,SAAU,QACjC9G,IAAM+G,EAAQ7G,SAASC,cAAc,OACrC4G,EAAMF,UAAY,aAClB7G,IAAMgH,EAAY9G,SAASC,cAAc,OACzC6G,EAAUH,UAAY,iBACtBD,EAAUK,YAAYF,GACtBH,EAAUK,YAAYD,GACtBxJ,KAAK0J,SAAWN,EAChBpJ,KAAK2J,SAAWH,EAECxJ,KAAKiJ,UACbW,sBAAsB,WAAYR,EAC/C,EAEOR,EAAAnI,UAAAoJ,WAAA,WAGH,IAFAnJ,IAAIoJ,EAAQ,CAAC,WAAY,YAAa,cAAe,gBAE5CxH,EAAI,EAAGA,EAAIwH,EAAMxJ,OAAQgC,IAAK,CACnC5B,IAAI0E,EAAI0E,EAAMxH,GAEd,GADAtC,KAAK+J,UAAU3E,IACVpF,KAAKgK,SAAU,KACvB,CACL,cAOQD,UAAS,SAAEE,GACf,GAAKjK,KAAK0J,SAAV,CAEAhJ,IAAIwJ,EAAI/C,EAAUnH,KAAKiJ,WACnBkB,EAAI/B,EAAUpI,KAAKiJ,UAAW,UAC9BmB,EAAIvC,EAAS7H,KAAKiJ,UAAW,SAGjCoB,EAAsC5D,IAArB6D,EAAAD,EAAAtD,WAAuCwD,EAAAF,EAAAnD,UACxDgD,EAAE5C,KAAOgD,EACTJ,EAAE3C,MAAQgD,EAEV7J,IAAI8J,EAAKpC,EAAUpI,KAAK0J,SAAU,SAC9Be,EAAK5C,EAAS7H,KAAK0J,SAAU,SAEjC1J,KAAK0J,SAASgB,UAAUC,OAAO,mBAC/B3K,KAAK0J,SAASgB,UAAUC,OAAO,oBAC/B3K,KAAK0J,SAASgB,UAAUC,OAAO,uBAC/B3K,KAAK0J,SAASgB,UAAUC,OAAO,sBAE/BjK,IAAI6G,EAAO,EAAGD,EAAM,EACpB,OAAQ2C,GACJ,IAAK,WAED1C,EAAO2C,EAAE3C,KAAO6C,EAAIK,EACpBnD,EAAM4C,EAAE5C,IAAMkD,EAhFP,GAiFP,MACJ,IAAK,YAEDjD,EAAO2C,EAAE3C,KACTD,EAAM4C,EAAE5C,IAAMkD,EArFP,GAsFP,MACJ,IAAK,eAEDjD,EAAO2C,EAAE3C,KACTD,EAAM4C,EAAE5C,IAAM6C,EA1FP,GA2FP,MACJ,IAAK,cAED5C,EAAO2C,EAAE3C,KAAO6C,EAAIK,EACpBnD,EAAM4C,EAAE5C,IAAM6C,EA/FP,GAmGfnK,KAAK0J,SAAS1G,MAAMsE,IAAMA,EAAM,KAChCtH,KAAK0J,SAAS1G,MAAMuE,KAAOA,EAAO,KAClCvH,KAAK0J,SAASgB,UAAUE,IAAI,UAAYX,EA7Cb,CA8C/B,EAEQrB,EAAAnI,UAAAuJ,OAAA,WACJ,GAAKhK,KAAK0J,SAAV,CAEAhJ,IAAIwJ,EAAI/C,EAAUnH,KAAK0J,UACnBc,EAAKpC,EAAUpI,KAAK0J,SAAU,SAC9Be,EAAK5C,EAAS7H,KAAK0J,SAAU,SAE7BmB,EAAKnI,SAASoI,cAAc,QAAS/C,YACrCgD,EAAKrI,SAASoI,cAAc,QAASzC,aACzCgC,EAAsC5D,IAArB6D,EAAAD,EAAAtD,WAAuCwD,EAAAF,EAAAnD,UAEpDI,EAAM4C,EAAE5C,IAAMgD,EACd/C,EAAO2C,EAAE3C,KAAOgD,EAEpB,OAAIjD,EADI,EACM,GAAKC,EADX,EACsB,IACtBD,EAAMkD,EAFN,EAEgBO,GAAOxD,EAAOkD,EAF9B,EAEwCI,EAdrB,CAe/B,EAEOjC,EAAAnI,UAAAuK,MAAA,SAAOC,EAAoBC,EAAcC,GAC5CnL,KAAKkJ,SAAU,EACflJ,KAAKoL,OACL1K,IAAI2K,EAAIrL,KAAK2J,SAER0B,IAGLA,EAAErI,MAAMG,OAAS,OACjBkI,EAAErI,MAAME,MAAQ,OAGhBmI,EAAEC,UAAYJ,EAGdG,EAAErI,MAAMG,OAASkI,EAAErI,MAAMG,QAAU,GACnCkI,EAAErI,MAAME,MAAQmI,EAAErI,MAAME,OAAS,GACjCmI,EAAEC,UAAY,GACdtL,KAAK6J,aAEL7J,KAAKuL,UAAYN,EACjBjL,KAAKwL,UAAUN,EAAMC,EAAMF,GAC/B,EAEOrC,EAAAnI,UAAA2K,KAAA,WACEpL,KAAK0J,WACN1J,KAAKkJ,SACTlJ,KAAK0J,SAAS+B,gBAAgB,UAClC,cAEOC,KAAI,SAAEC,SACLA,EACe,QAAftG,EAAArF,KAAK0J,gBAAU,IAAArE,GAAAA,EAAAiE,aAAa,SAAU,QAI1CtJ,KAAK8I,QAAU9C,OAAOC,WAAWjG,KAAK4L,mBAAmB7K,KAAKf,MA/J1C,IAgKxB,EAEQ4I,EAAAnI,UAAAmL,mBAAA,iBACA5L,KAAKO,UACM,QAAf8E,EAAArF,KAAK0J,gBAAU,IAAArE,GAAAA,EAAAiE,aAAa,SAAU,QACtCtJ,KAAKkJ,SAAU,EACflJ,KAAK8I,QAAU,KACnB,EAEQF,EAAAnI,UAAA+K,UAAA,SAAWN,EAAcC,EAAeF,cAC5CjL,KAAKO,SAAU,EACfP,KAAK+I,MAAQoC,EACbzK,IAAImL,EAAQX,EAAKY,MAAM,UAEnB5K,EAAKlB,KAAK2J,SACVoC,EAAM,EAGV/L,KAAKgJ,SAAQ,iBACJhJ,EAAKO,UACNwL,EAAMF,EAAMvL,QACZN,EAAKgJ,SAAW,KAChBhJ,EAAKO,SAAU,EACVP,EAAK+I,QACNkC,IACAjL,EAAK0L,MAAK,MAGVxK,IAAIA,EAAGoK,UAAYO,EAAMG,MAAM,EAAGD,GAAKE,KAAK,MAChDF,IAEA/L,EAAK+F,MAAQC,OAAOC,WAAwB,QAAbZ,EAAArF,EAAKgJ,gBAAQ,IAAA3D,OAAA,EAAAA,EAAEtE,KAAKf,GAhMnC,MAkMxB,EAEAA,KAAKgJ,UAET,EAEOJ,EAAAnI,UAAAyL,MAAA,WACClM,KAAKO,QACLP,KAAK+I,OAAQ,EACN/I,KAAK+I,OAAS/I,KAAKuL,WAC1BvL,KAAKuL,WAEb,EAEO3C,EAAAnI,UAAA6F,MAAA,WACCtG,KAAK+F,OACLC,OAAOO,aAAavG,KAAK+F,OAEzB/F,KAAK8I,UACL9C,OAAOO,aAAavG,KAAK8I,SACzB9I,KAAK8I,QAAU,KAEvB,EAEOF,EAAAnI,UAAA+F,OAAA,WACCxG,KAAKgJ,SACLhJ,KAAKgJ,WACGhJ,KAAK+I,OAAU/I,KAAKkJ,UAC5BlJ,KAAK8I,QAAU9C,OAAOC,WAAWjG,KAAK4L,mBAAmB7K,KAAKf,MA7N9C,KA+NxB,ECtNU,IAAOmM,EAcjB,SAAaC,GATLpM,KAAOkJ,SAAY,EAEnBlJ,KAAOqM,QAAmC,CAAE/E,IAAK,EAAGC,KAAM,GAS1D,IAAA+E,EAAAF,EAAAE,MAEQC,EAAAH,EAAAG,SAEZvM,KAAKC,OAAS,IAAIH,EAAME,KAAKwM,cAAczL,KAAKf,OAEhDwC,IAAMtB,EAAKwB,SAASC,cAAc,OAClCzB,EAAGmI,UAAY,SACfnI,EAAGoI,aAAa,SAAU,QAC1BtJ,KAAKqB,IAAMH,IAEMqL,EAAW7J,SAAS+J,uBAAuBF,GAAU,QAAK5K,IAC5De,SAASsE,MAAMyC,YAAYzJ,KAAKqB,KAE/CmB,IAAMkK,EAAwBC,OAAOC,OAAOR,EAAQE,MAAMO,UAE1D7M,KAAK8M,UAAY,IAAI7L,EAASjB,KAAKqB,IAAKiL,EAAOI,GAC/C1M,KAAK0J,SAAW,IAAId,EAAQ5I,KAAKqB,KACjCrB,KAAK+M,cACT,EC5CJ,SAASC,EAAWnJ,GAChB,OAAO,IAAI4E,SAAO,SAAOC,EAASC,GAC9BsE,OAAO,YAAYpJ,EAAI,OAAOqJ,MAAK,SAAAC,GAC/BzE,EAAQyE,EAAOC,QACnB,IAAGC,OAAK,SAACC,GACL3E,EAAO2E,EACX,GACJ,GACJ,CD2CInB,EAAA1L,UAAA8M,UAAA,SAAWC,EAAWC,GAClB/M,IAAI6C,EAAIvD,KAAK0N,cAAcF,EAAGC,GAC1BE,EAAQ,UAAYpK,EACpBqK,EAAW,OAASrK,EAEpBsK,EAAY7N,KAAK4D,aAAa+J,GAASA,EAAQC,EACnD,OAAO5N,KAAKwF,KAAKqI,EACrB,EAOA1B,EAAA1L,UAAAiL,KAAA,SAAMC,EAAemC,cAIjB,OAHA9N,KAAKkJ,SAAU,EACNlJ,KAAKqB,IACdrB,KAAK+N,OACDpC,GACA3L,KAAKqB,IAAIiI,aAAa,SAAU,QAChCtJ,KAAK+N,OACL/N,KAAKsG,aACDwH,GAAUA,MAIX9N,KAAKgO,cAAc,mBACtBhO,EAAKqB,IAAIiI,aAAa,SAAU,QAChCtJ,EAAKsG,QACDwH,GAAUA,GAClB,GACJ,EAGA3B,EAAA1L,UAAAwN,OAAA,SAAQT,EAAWC,EAAWvH,cAEtBgI,EAAO,OADDlO,KAAK0N,cAAcF,EAAGC,QAEf9L,IAAbuE,IAAwBA,EAAW,KAEvClG,KAAKmO,aAAa,SAAClD,GAEf,GAAiB,IAAb/E,EAKA,OAJAlG,EAAKqB,IAAI2B,MAAMsE,IAAMmG,EAAI,KACzBzN,EAAKqB,IAAI2B,MAAMuE,KAAOiG,EAAI,KAC1BxN,EAAK6J,kBACLoB,IAKJ,IAAKjL,EAAK4D,aAAasK,GAAO,CAC1B1L,IAAM4L,EAAU,WACZpO,EAAKqB,IAAIgN,oBAAoB,eAAgBD,GAC7CnD,GACJ,EAMA,OALAjL,EAAKqB,IAAIiN,iBAAiB,eAAgBF,QAC1CpO,EAAKqB,IAAIkN,QAAQ,CAAEjH,IAAKmG,EAAGlG,KAAMiG,GAAK,UAClCtH,EACAsI,WAAY,GAGnB,CAuBDxO,EAAKgO,cAAcE,GArBP,SAAKrK,EAAc4K,GAM3B,GAJIA,IAAUxN,EAASkF,OAAOE,QAC1B4E,IAGAwD,IAAUxN,EAASkF,OAAOC,QAAS,CAEnC5D,IAAM4L,EAAU,WACZpO,EAAKqB,IAAIgN,oBAAoB,eAAgBD,GAC7CpO,EAAK8M,UAAUhJ,eACnB,EACA9D,EAAKqB,IAAIiN,iBAAiB,eAAgBF,GAC1CpO,EAAKqB,IAAIkN,QAAQ,CAAEjH,IAAKmG,EAAI,KAAMlG,KAAMiG,EAAI,MAAO,UAC/CtH,EACAsI,WAAY,GAEnB,CAEL,GAGH,GAAExO,KACP,EAEQmM,EAAA1L,UAAAuN,cAAA,SAAeH,EAAgBC,cAG/B9N,KAAK0O,oBAAsB1O,KAAK2O,UAChC3O,KAAK2O,SAASnG,QAAQ0E,iBAClBlN,EAAKgO,cAAcH,EAAWC,EAClC,IAGJ9N,KAAK8M,UAAU/I,cAAc8J,EAAWC,EAC5C,EAEA3B,EAAA1L,UAAA+E,KAAA,SAAMqI,EAAgBe,EAAkBC,cACpC,QAAK7O,KAAK4D,aAAaiK,UAEPlM,IAAZiN,IAAuBA,EAAU,KAGrC5O,KAAKmO,aAAa,SAAClD,GACfvK,IAAIoO,GAAY,EAWZF,GACA5I,OAAOC,YAAU,WACT6I,GAEJ9O,EAAK8M,UAAUhJ,eAClB,GAAE8K,GAGP5O,EAAKgO,cAAcH,GAjBJ,SAAUhK,EAAc4K,GAC/BA,IAAUxN,EAASkF,OAAOE,SAC1ByI,GAAY,EACRD,GAAIA,IACR5D,IAER,GAYH,GAAEjL,OAEI,EACX,cAMAoL,KAAI,SAAEO,GAGF,mBAHkB,GAElB3L,KAAKkJ,SAAU,EACXyC,EAIA,OAHA3L,KAAKqB,IAAIoK,gBAAgB,UACzBzL,KAAKwG,cACLxG,KAAKwM,gBAIThK,IAAMuM,EAAS/O,KAAKqB,IAAI2B,MAAMsE,IACxB0H,EAAUhP,KAAKqB,IAAI2B,MAAMuE,KAC/B,GAAe,SAAXwH,GAAmC,SAAZC,EAAoB,CAC3CtO,IAGI6G,EAAY,GAHP7E,SAASoI,cAAc,QAAS/C,YAIrCT,EAAkB,IAHb5E,SAASoI,cAAc,QAASzC,aAClB5B,IAAkBM,YAGzC/G,KAAKqB,IAAI2B,MAAMsE,IAAMA,EAAM,KAC3BtH,KAAKqB,IAAI2B,MAAMuE,KAAOA,EAAO,IAChC,CAGD,OADAvH,KAAKwG,SACExG,KAAKwF,KAAK,OACrB,EAMA2G,EAAA1L,UAAAuK,MAAA,SAAOE,EAAcC,8BAAgB,GACjCnL,KAAKmO,aAAa,SAAClD,GACfjL,EAAK0J,SAASsB,MAAMC,EAAUC,EAAMC,EACvC,GAAEnL,KACP,EAMAmM,EAAA1L,UAAAwO,aAAA,WACIjP,KAAK0J,SAASgC,MAClB,cAEAwD,MAAK,SAAEC,cACHA,EAAOA,GAAQ,IAEfnP,KAAKmO,aAAa,SAAClD,GACfjL,EAAKwM,gBACLxG,OAAOC,WAAWgF,EAAUkE,EAChC,GACJ,EAKAhD,EAAA1L,UAAA2O,YAAA,WACIpP,KAAK8M,UAAUhJ,gBACf9D,KAAK0J,SAASwC,OAClB,EAGAC,EAAA1L,UAAAsN,KAAA,WAEI/N,KAAKC,OAAOe,QACZhB,KAAK8M,UAAUhJ,gBACf9D,KAAK0J,SAASgC,MAClB,cAOA9H,aAAY,SAAEC,GACV,OAAO7D,KAAK8M,UAAUlJ,aAAaC,EACvC,EAOAsI,EAAA1L,UAAA4C,WAAA,WACI,OAAOrD,KAAK8M,UAAUzJ,YAC1B,EAMA8I,EAAA1L,UAAA8N,QAAA,WACI7N,IAAI2C,EAAarD,KAAKqD,aAClB6K,EAAO7K,EAAWwB,KAAKwK,MAAMxK,KAAKC,SAAWzB,EAAW/C,SAE5D,OAA6B,IAAzB4N,EAAKoB,QAAQ,QACNtP,KAAKuO,UAETvO,KAAKwF,KAAK0I,EACrB,EAWQ/B,EAAA1L,UAAAiN,cAAA,SAAeF,EAAWC,GAC9B/M,IAAI6O,EAASpI,EAAUnH,KAAKqB,KACxB8I,EAAI/B,EAAUpI,KAAKqB,IAAK,UACxB+I,EAAIvC,EAAS7H,KAAKqB,IAAK,SAEvBmO,EAAWD,EAAOhI,KAAO6C,EAAI,EAI7BqF,EAHWF,EAAOjI,IAAM6C,EAAI,EAGdsD,EACdiC,EAAIF,EAAUhC,EAEdlK,EAAIuB,KAAK8K,MAAO,IAAM9K,KAAK+K,MAAMH,EAAGC,GAAM7K,KAAKgL,IAGnD,OAAK,IAAMvM,GAAKA,EAAI,GAAW,QAC3B,IAAMA,GAAKA,EAAI,IAAY,KAC3B,KAAOA,GAAKA,GAAK,MAAQ,KAAOA,GAAKA,GAAK,IAAY,QACrD,KAAOA,GAAKA,GAAK,GAAW,OAG1B,KACX,EASQ6I,EAAA1L,UAAA+L,cAAA,WACJ,IAAIxM,KAAKkJ,UAAWlJ,KAAK0O,mBAAzB,CACAhO,IAAIoP,EAAW9P,KAAK+P,oBACpB/P,KAAK2O,SAAW,IAAIpG,EAEpBvI,KAAK8M,UAAU/I,cAAc+L,EAAU9P,KAAKgQ,gBAAgBjP,KAAKf,MAJb,CAKxD,EAEQmM,EAAA1L,UAAAuP,gBAAA,SAAiBnM,EAAc4K,SAC/BA,IAAUxN,EAASkF,OAAOE,SACb,QAAbhB,EAAArF,KAAK2O,gBAAQ,IAAAtJ,GAAAA,EAAEqD,aAAQ/G,GAE/B,EAOQwK,EAAA1L,UAAAiO,iBAAA,WACJhO,IAAI2K,EAAIrL,KAAK8M,UAAU7K,qBACvB,OAAOoJ,GAA2B,IAAtBA,EAAEiE,QAAQ,OAC1B,EAQQnD,EAAA1L,UAAAsP,kBAAA,WAGJ,IAFArP,IAAI2C,EAAarD,KAAKqD,aAClBC,EAAI,GACChB,EAAI,EAAGA,EAAIe,EAAW/C,OAAQgC,IAAK,CACxC5B,IAAI+O,EAAIpM,EAAWf,GACO,IAAtBmN,EAAEH,QAAQ,SACVhM,EAAEjD,KAAKoP,EAEd,CAID,OAAOnM,EADGuB,KAAKwK,MAAMxK,KAAKC,SAAWxB,EAAEhD,QAE3C,EAIQ6L,EAAA1L,UAAAsM,aAAA,WACJ/G,OAAOsI,iBAAiB,SAAUtO,KAAK6J,WAAW9I,KAAKf,OACvDA,KAAKqB,IAAIiN,iBAAiB,YAAatO,KAAKiQ,aAAalP,KAAKf,OAC9DA,KAAKqB,IAAIiN,iBAAiB,WAAYtO,KAAKkQ,eAAenP,KAAKf,MACnE,EAEQmM,EAAA1L,UAAAyP,eAAA,WACClQ,KAAKwF,KAAK,cACXxF,KAAKuO,SAEb,EAEApC,EAAA1L,UAAAoJ,WAAA,WACI,GAA0C,SAApC7J,KAAKqB,IAAI8O,aAAa,UAA5B,CACAzP,IAAIwJ,EAAI/C,EAAUnH,KAAKqB,KACnBmJ,EAAKpC,EAAUpI,KAAKqB,IAAK,SACzBoJ,EAAK5C,EAAS7H,KAAKqB,IAAK,SAExBwJ,EAAKnI,SAASoI,cAAc,QAAS/C,YACrCgD,EAAKrI,SAASoI,cAAc,QAASzC,aACzCgC,EAAsC5D,IAArB6D,EAAAD,EAAAtD,WAAuCwD,EAAAF,EAAAnD,UAEpDI,EAAM4C,EAAE5C,IAAMgD,EACd/C,EAAO2C,EAAE3C,KAAOgD,EAEhBjD,EADI,EACM,EACVA,EAFI,EAGIA,EAAMkD,EAHV,EAGoBO,IACxBzD,EAAMyD,EAAKP,EAJP,GAOJjD,EAPI,EAOO,EACXA,EARI,EASGA,EAAOkD,EATV,EASmBI,IACvBtD,EAAOsD,EAAKJ,EAVR,GAaRzK,KAAKqB,IAAI2B,MAAMuE,KAAOA,EAAO,KAC7BvH,KAAKqB,IAAI2B,MAAMsE,IAAMA,EAAM,KAE3BtH,KAAK0J,SAASG,YA3B4C,CA4B9D,cAEQoG,aAAY,SAAEG,GAClBA,EAAEC,iBACFrQ,KAAKsQ,WAAWF,EACpB,cAKQE,WAAU,SAAEF,GAEhBpQ,KAAKsG,QACLtG,KAAK0J,SAASgC,MAAK,GACnB1L,KAAKqM,QAAUrM,KAAKuQ,sBAAsBH,GAE1CpQ,KAAKwQ,YAAcxQ,KAAKyQ,UAAU1P,KAAKf,MACvCA,KAAK0Q,UAAY1Q,KAAK2Q,YAAY5P,KAAKf,MAEvCgG,OAAOsI,iBAAiB,YAAatO,KAAKwQ,aAC1CxK,OAAOsI,iBAAiB,UAAWtO,KAAK0Q,WAExC1Q,KAAK4Q,gBAAkB5K,OAAOC,WAAWjG,KAAK6Q,gBAAgB9P,KAAKf,MAAO,GAC9E,cAEQuQ,sBAAqB,SAAEH,GAC3B1P,IAAIoQ,EAASV,EAAEW,MACXC,EAASZ,EAAEa,MACX/G,EAAI/C,EAAUnH,KAAKqB,KACvB,MAAO,CACHiG,IAAK0J,EAAS9G,EAAE5C,IAChBC,KAAMuJ,EAAS5G,EAAE3C,KAGzB,EAEQ4E,EAAA1L,UAAAoQ,gBAAA,WACJ7Q,KAAKqB,IAAI2B,MAAMsE,KAAOtH,KAAKkR,UAAY,GAAK,KAC5ClR,KAAKqB,IAAI2B,MAAMuE,MAAQvH,KAAKmR,UAAY,GAAK,KAC7CnR,KAAK4Q,gBAAkB5K,OAAOC,WAAWjG,KAAK6Q,gBAAgB9P,KAAKf,MAAO,GAC9E,cAEQyQ,UAAS,SAAEL,GACfA,EAAEC,iBACF3P,IAAI8M,EAAI4C,EAAEgB,QAAUpR,KAAKqM,QAAQ9E,KAC7BkG,EAAI2C,EAAEiB,QAAUrR,KAAKqM,QAAQ/E,IACjCtH,KAAKmR,SAAW3D,EAChBxN,KAAKkR,SAAWzD,CACpB,EAEQtB,EAAA1L,UAAAkQ,YAAA,WACJ3K,OAAOO,aAAavG,KAAK4Q,iBAErB5Q,KAAKwQ,aACLxK,OAAOqI,oBAAoB,YAAarO,KAAKwQ,aAE7CxQ,KAAK0Q,WACL1K,OAAOqI,oBAAoB,UAAWrO,KAAK0Q,WAG/C1Q,KAAK0J,SAAS0B,OACdpL,KAAK6J,aACL7J,KAAKwG,QAET,EAEQ2F,EAAA1L,UAAA0N,YAAA,SAAa/N,EAAgBkR,GAC7BA,IAAOlR,EAAOA,EAAKW,KAAKuQ,IAC5BtR,KAAKC,OAAOE,MAAMC,EACtB,EAIA+L,EAAA1L,UAAA6F,MAAA,WACItG,KAAK8M,UAAUxG,QACftG,KAAK0J,SAASpD,OAElB,EAEA6F,EAAA1L,UAAA+F,OAAA,WACIxG,KAAK8M,UAAUtG,SACfxG,KAAK0J,SAASlD,QAClB,ECxeGhE,IAAM+O,EAA8B,CACvCC,MAAO,WAAA,OAAMxE,EAAU,QAAQ,EAC/ByE,OAAQ,WAAA,OAAMzE,EAAU,SAAS,EACjC0E,GAAI,WAAA,OAAM1E,EAAU,KAAK,EACzB2E,MAAO,WAAA,OAAM3E,EAAU,QAAQ,EAC/B4E,OAAQ,WAAA,OAAM5E,EAAU,SAAS,EACjC6E,MAAO,WAAA,OAAM7E,EAAU,QAAQ,EAC/B8E,OAAQ,WAAA,OAAM9E,EAAU,SAAS,EACjC+E,MAAO,WAAA,OAAM/E,EAAU,QAAQ,EAC/BgF,MAAO,WAAA,OAAMhF,EAAU,QAAQ,EAC/BiF,MAAO,WAAA,OAAMjF,EAAU,QAAQ,EAC/BkF,KAAM,WAAA,OAAMlF,EAAU,OAAO,GCvB7BoD,EAAE,GAAG+B,EAAE,IAAG,SAAW3O,EAAEF,GAAG,GAAGE,GAAG,oBAAoBd,SAAS,CAAC,IAAI+M,EAAErK,GAAE,IAAK9B,EAAE8O,QAAQ,UAAU,SAAS7O,GAAE,IAAKD,EAAE+O,UAAU/P,EAAE,iBAAiBgB,EAAEgP,UAAU5P,SAASoI,cAAcxH,EAAEgP,WAAW5P,SAAS6P,qBAAqB,QAAQ,GAAG,GAAGhP,EAAE,CAAC,IAAIiP,EAAEpC,EAAEd,QAAQhN,IAAI,IAAIkQ,IAAIA,EAAEpC,EAAE/P,KAAKiC,GAAG,EAAE6P,EAAEK,GAAG,CAAA,GAAI/C,EAAE0C,EAAEK,IAAIL,EAAEK,GAAGpN,GAAG+M,EAAEK,GAAGpN,GAAG+M,EAAEK,GAAGpN,GAAGiG,GAAG,MAAMoE,EAAEpE,IAAI,QAAQ7H,EAAEiP,WAAW,KAAKjP,EAAEA,EAAEkP,UAAU,IAAIjD,EAAEkD,WAAWlD,EAAEkD,WAAWC,SAASpP,EAAEiM,EAAEhG,YAAY/G,SAASmQ,eAAerP,GAAG,CAAC,SAAS6H,IAAI,IAAI+E,EAAE1N,SAASC,cAAc,SAAS,GAAGyN,EAAE9G,aAAa,OAAO,YAAYhG,EAAEwP,WAAW,IAAI,IAAIX,EAAExF,OAAOoG,KAAKzP,EAAEwP,YAAYtP,EAAE,EAAEA,EAAE2O,EAAE7R,OAAOkD,IAAI4M,EAAE9G,aAAa6I,EAAE3O,GAAGF,EAAEwP,WAAWX,EAAE3O,KAAK,IAAIiM,EAAE,YAAYrK,EAAE,aAAa,YAAY,OAAO9C,EAAEsH,sBAAsB6F,EAAEW,GAAGA,CAAC,CAAC,m5CCQruB,IAAM4C,EAAiB,MCJH,SAAC5G,GAMhB,IAAA/B,EAAG+B,GAAW,GAJXvI,EAAAwG,EAAAxG,KACAoP,EAAA5I,EAAA4I,UACAC,EAAA7I,EAAA6I,OAEc3G,EAAAlC,EAAAkC,SAGlBgF,EAAO1N,KAAQqJ,MAAI,SAAEiG,GACjB3Q,IAAMiN,EAAI,IAAItD,EAAM,CAChBG,MAAO6G,WACP5G,IAEA0G,GAAWA,EAAUxD,EAC7B,IAAGpC,OAAM,SAAC+F,GACFF,GAAQA,EAAOE,EACvB,GAEJ,EDbI7B,OAAQ,CAAqC"}